<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://optimizely-staging.s3.amazonaws.com/js/5398415178727424.js"></script>
    <title>Optimizely CSP Test - HTML Editor Loading Issue</title>
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a6fd8;
            --success: #28a745;
            --warning: #ffc107;
            --bg: #f5f7fa;
            --card-bg: #ffffff;
            --text: #2c3e50;
            --text-muted: #6c757d;
            --border: #e9ecef;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .header h1 {
            margin: 0 0 0.5rem 0;
            font-size: 2.5rem;
            font-weight: 600;
        }

        .header p {
            margin: 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .instructions h3 {
            margin-top: 0;
            color: #856404;
        }

        .code-block {
            background: #f8f9fa;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 1rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .test-section {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .test-section h2 {
            margin: 0 0 1rem 0;
            color: var(--text);
            font-size: 1.5rem;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 0.5rem;
        }

        .editable-content {
            background: #f8f9ff;
            border: 2px dashed var(--primary);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin: 1.5rem 0;
        }

        .test-button {
            background: var(--primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .test-button:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .test-button.success {
            background: var(--success);
        }

        .test-button.warning {
            background: var(--warning);
            color: var(--text);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
            margin-right: 8px;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .button-group { flex-direction: column; }
            .form-grid { grid-template-columns: 1fr; }
        }
    </style>
    
    <!-- Mock Optimizely Snippet - Ho·∫°t ƒë·ªông m√† kh√¥ng c·∫ßn Project ID th·∫≠t -->
    <script>
        // T·∫°o mock Optimizely object ƒë·ªÉ test
        window.optimizely = window.optimizely || [];
        window.optimizely.push = function(command) {
            console.log('Mock Optimizely command:', command);
        };
        
        // Simulate Optimizely activation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Mock Optimizely snippet loaded successfully');
            console.log('Page ready for Visual Editor testing');
            
            // Add some mock tracking
            window.optimizely.push(['trackEvent', 'page_loaded', {
                page_title: document.title,
                timestamp: new Date().toISOString()
            }]);
        });
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Optimizely CSP Test Page</h1>
            <p>Trang test ƒë·ªÉ reproduce HTML Editor loading issue v·ªõi Content Security Policy</p>
        </div>

        <div class="instructions">
            <h3>üìã H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng ModHeader:</h3>
            <ol>
                <li><strong>C√†i ƒë·∫∑t ModHeader extension</strong> cho Chrome/Edge</li>
                <li><strong>T·∫°o profile m·ªõi</strong> v·ªõi URL pattern cho trang n√†y</li>
                <li><strong>Th√™m Response Header:</strong>
                    <div class="code-block"><strong>Name:</strong> Content-Security-Policy<br>
<strong>Value:</strong> default-src 'self'; frame-ancestors https://app.optimizely.com; script-src 'self'; style-src 'self'; connect-src 'self'; img-src 'self' data:</div>
                </li>
                <li><strong>Reload trang</strong> v√† m·ªü trong Optimizely Visual Editor</li>
                <li><strong>Th·ª≠ "Edit HTML"</strong> ‚Üí HTML Editor s·∫Ω loading m√£i kh√¥ng d·ª´ng</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>üéØ Section 1: Text Content Testing</h2>
            <div class="editable-content">
                <p><strong>ƒê√¢y l√† ƒëo·∫°n text ch√≠nh ƒë·ªÉ test HTML Editor.</strong> H√£y click "Edit HTML" tr√™n paragraph n√†y ƒë·ªÉ reproduce loading issue. Content n√†y ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·∫∑c bi·ªát ƒë·ªÉ test c√°c t√≠nh nƒÉng c·ªßa Optimizely Visual Editor.</p>
                <p>ƒêo·∫°n vƒÉn th·ª© hai v·ªõi <em>text in nghi√™ng</em> v√† <strong>text ƒë·∫≠m</strong>. B·∫°n c√≥ th·ªÉ th·ª≠ edit HTML tr√™n b·∫•t k·ª≥ ph·∫ßn n√†o c·ªßa content n√†y ƒë·ªÉ trigger v·∫•n ƒë·ªÅ loading spinner.</p>
                <ul>
                    <li>Item 1: Test HTML Editor tr√™n list item n√†y</li>
                    <li>Item 2: Ho·∫∑c th·ª≠ rearrange c√°c items</li>
                    <li>Item 3: Check console ƒë·ªÉ xem CSP violations</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h2>üîò Section 2: Interactive Elements</h2>
            <div class="button-group">
                <button class="test-button" onclick="handleButtonClick(this)">Primary Button - Test Edit HTML</button>
                <button class="test-button success" onclick="handleButtonClick(this)">Success Button - Try HTML Editor</button>
                <button class="test-button warning" onclick="handleButtonClick(this)">Warning Button - CSP Test</button>
            </div>
            <p>Th·ª≠ click "Edit HTML" tr√™n c√°c buttons tr√™n ƒë·ªÉ test HTML Editor popup loading issue. M·ªói button c√≥ styling kh√°c nhau ƒë·ªÉ test comprehensive.</p>
        </div>

        <div class="test-section">
            <h2>üìù Section 3: Form Elements</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="test-input">Test Input Field:</label>
                    <input type="text" id="test-input" placeholder="Try HTML Editor on this input field">
                </div>
                <div class="form-group">
                    <label for="test-select">Test Select Dropdown:</label>
                    <select id="test-select">
                        <option value="">Choose option to test HTML Editor</option>
                        <option value="option1">Option 1 - Edit HTML Test</option>
                        <option value="option2">Option 2 - CSP Loading Issue</option>
                        <option value="option3">Option 3 - Visual Editor Works</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="test-textarea">Test Textarea:</label>
                <textarea id="test-textarea" rows="4" placeholder="Test HTML Editor loading spinner issue on this textarea element. Should show forever loading when CSP is configured correctly."></textarea>
            </div>
        </div>

        <div class="test-section">
            <h2>üé¥ Section 4: Card Layout Testing</h2>
            <div class="card-grid">
                <div class="card">
                    <h3><span class="status-indicator"></span>Card 1: HTML Editor Test</h3>
                    <p>Card n√†y ch·ª©a nhi·ªÅu elements kh√°c nhau ƒë·ªÉ test HTML Editor. CSP configuration s·∫Ω prevent HTML Editor loading nh∆∞ng Visual Editor v·∫´n ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng.</p>
                    <button class="test-button" onclick="handleButtonClick(this)">Card Button 1</button>
                </div>
                <div class="card">
                    <h3><span class="status-indicator"></span>Card 2: CSP Violation Testing</h3>
                    <p>Card th·ª© hai ƒë·ªÉ test comprehensive HTML Editor functionality. Check Developer Console ƒë·ªÉ xem c√°c CSP violation errors khi HTML Editor c·ªë load.</p>
                    <button class="test-button success" onclick="handleButtonClick(this)">Card Button 2</button>
                </div>
                <div class="card">
                    <h3><span class="status-indicator"></span>Card 3: Loading Spinner Issue</h3>
                    <p>Card cu·ªëi c√πng v·ªõi content structure kh√°c ƒë·ªÉ test HTML Editor behavior under CSP restrictions. Perfect ƒë·ªÉ demonstrate issue cho clients.</p>
                    <button class="test-button warning" onclick="handleButtonClick(this)">Card Button 3</button>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üîç Section 5: Expected Results & Debug Info</h2>
            <div class="editable-content">
                <h4>Expected Behavior khi test:</h4>
                <ul>
                    <li>‚úÖ <strong>Visual Editor loads successfully</strong> (nh·ªù frame-ancestors directive)</li>
                    <li>‚ùå <strong>HTML Editor shows loading spinner forever</strong> (do script-src restrictions)</li>
                    <li>üîç <strong>Console shows CSP violation errors</strong></li>
                    <li>üö´ <strong>Network tab shows blocked Optimizely requests</strong></li>
                </ul>
                
                <h4>Console Errors c·∫ßn t√¨m:</h4>
                <div class="code-block">Refused to load the script 'https://cdn.optimizely.com/...' because it violates the following Content Security Policy directive: "script-src 'self'"

Refused to execute inline script because it violates CSP directive 'script-src'

Refused to apply inline style because it violates CSP directive 'style-src'</div>

                <h4>Network Tab - Blocked Requests:</h4>
                <ul>
                    <li>Requests ƒë·∫øn <code>*.optimizely.com</code> v·ªõi status <code>(blocked:csp)</code></li>
                    <li>Failed loads cho HTML Editor resources</li>
                    <li>Successful iframe load cho Visual Editor</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        function handleButtonClick(button) {
            console.log('Button clicked:', button.textContent);
            
            // Mock Optimizely tracking
            window.optimizely.push(['trackEvent', 'button_click', {
                button_text: button.textContent,
                timestamp: new Date().toISOString()
            }]);
            
            alert('Button clicked: ' + button.textContent + '\n\nB√¢y gi·ªù h√£y th·ª≠ "Edit HTML" tr√™n button n√†y trong Optimizely Visual Editor ƒë·ªÉ reproduce loading spinner issue.');
        }

        // Page load tracking
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ Test page loaded successfully');
            console.log('üîß Ready for Optimizely Visual Editor testing');
            console.log('üìù Use "Edit HTML" on any element to reproduce loading issue');
            
            // Test CSP detection
            setTimeout(function() {
                console.log('üîç Page ready - if you see CSP violations when using HTML Editor, the test is working correctly');
            }, 1000);
        });
    </script>
</body>
</html>
