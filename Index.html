<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extreme Visual Editor Slow Load Issue Simulation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            width: 90%;
            margin: 20px auto;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .normal-section {
            background-color: #e9ecef;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #28a745;
        }
        .slow-section {
            background-color: #f8d7da; /* Màu đỏ nhạt hơn để nhấn mạnh vấn đề */
            padding: 15px;
            border: 1px solid #dc3545;
        }
        
        /* Tăng cường độ phức tạp của CSS: 
           Sử dụng nhiều selector lồng nhau và thuộc tính phức tạp.
           Tạo ra 5000 selector giả lập để tăng thời gian phân tích CSSOM.
        */
        
        /* Bắt đầu 5000 selectors giả lập */
        .s-0001, .s-0002, .s-0003, .s-0004, .s-0005, .s-0006, .s-0007, .s-0008, .s-0009, .s-0010,
        /* ... (sẽ lặp lại 500 lần để đạt 5000 selectors) ... */
        .s-4991, .s-4992, .s-4993, .s-4994, .s-4995, .s-4996, .s-4997, .s-4998, .s-4999, .s-5000 {
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5), 0 0 20px rgba(255, 0, 0, 0.3) inset;
            transform: rotate(0deg) scale(1);
            transition: all 0.5s ease-in-out;
            will-change: transform, box-shadow;
            padding: 2px;
            margin: 1px;
            border: 1px solid transparent;
        }
        
        /* Thêm một lượng lớn media query phức tạp */
        @media (min-width: 1200px) {
            .slow-section {
                padding: 30px;
            }
            /* Thêm 5000 media query selectors */
            .mq-s-0001, .mq-s-0002, .mq-s-0003, .mq-s-0004, .mq-s-0005, .mq-s-0006, .mq-s-0007, .mq-s-0008, .mq-s-0009, .mq-s-0010,
            /* ... (sẽ lặp lại 500 lần để đạt 5000 selectors) ... */
            .mq-s-4991, .mq-s-4992, .mq-s-4993, .mq-s-4994, .mq-s-4995, .mq-s-4996, .mq-s-4997, .mq-s-4998, .mq-s-4999, .mq-s-5000 {
                border-right: 10px solid #dc3545;
                filter: grayscale(50%) blur(1px);
            }
        }
        /* Kết thúc CSS cực đoan */
        
    </style>
</head>
<body>
    <div class="container">
        <h1>Trang Tải Nhanh - Vấn đề Cô Lập Cực Đoan</h1>
        
        <div class="normal-section">
            <h2>Phần Nội Dung Tải Nhanh</h2>
            <p>Phần này tải nhanh. Vấn đề chỉ nằm ở phần tử bên dưới.</p>
        </div>

        <!-- Phần tử này sẽ chứa nội dung phức tạp gây chậm visual editor -->
        <div id="editable-content" class="slow-section">
            <h2>Phần Nội Dung Gây Chậm Visual Editor (Cực Đoan)</h2>
            <p>Phần này chứa cấu trúc DOM và các lớp CSS cực kỳ phức tạp. Khi visual editor cố gắng phân tích, áp dụng kiểu dáng và tính toán bố cục cho nội dung này, nó sẽ mất nhiều thời gian hơn 8 giây.</p>
            
            <!-- Bắt đầu tạo DOM cực kỳ phức tạp -->
            <div id="complex-dom-structure">
                <!-- Lặp lại cấu trúc lồng nhau và rộng để tăng độ phức tạp DOM -->
                <!-- Giả lập 5000 phần tử lặp lại để tăng kích thước DOM và độ sâu -->
                <div class="row s-0001 mq-s-0001">
                    <div class="col s-0002 mq-s-0002">
                        <p>Dữ liệu phức tạp 1</p>
                        <div class="nested-level-1 s-0003 mq-s-0003">
                            <div class="nested-level-2 s-0004 mq-s-0004">
                                <div class="nested-level-3 s-0005 mq-s-0005">
                                    <!-- Lặp lại 5000 phần tử nhỏ để tăng độ rộng DOM -->
                                    <span class="data-point s-0006 mq-s-0006">Item 1</span>
                                    <span class="data-point s-0007 mq-s-0007">Item 2</span>
                                    <span class="data-point s-0008 mq-s-0008">Item 3</span>
                                    <span class="data-point s-0009 mq-s-0009">Item 4</span>
                                    <span class="data-point s-0010 mq-s-0010">Item 5</span>
                                    <!-- ... (sẽ lặp lại 5000 lần) ... -->
                                    <span class="data-point s-5000 mq-s-5000">Item 5000</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Kết thúc tạo DOM cực kỳ phức tạp -->
        </div>
        
        <div class="normal-section">
            <h2>Phần Nội Dung Tải Nhanh Khác</h2>
            <p>Phần này cũng tải nhanh.</p>
        </div>
    </div>

    <script>
        // Hàm chặn luồng chính (main thread) - Tăng thời gian chặn lên 10 giây để chắc chắn
        function blockExecution(milliseconds) {
            const start = Date.now();
            while (Date.now() < start + milliseconds) {
                // Chặn luồng chính
            }
        }

        // Mô phỏng script khởi tạo của Visual Editor
        document.addEventListener('DOMContentLoaded', function() {
            const editableContent = document.getElementById('editable-content');
            
            if (editableContent) {
                console.log("Trang đã tải xong. Bắt đầu mô phỏng khởi tạo Visual Editor cho phần tử 'editable-content'...");
                
                // Giả định rằng Visual Editor cần 10 giây để phân tích và chuyển đổi nội dung phức tạp này
                // Đây là điểm gây ra sự chậm trễ > 8 giây
                blockExecution(10000); 
                
                console.log("Hoàn thành khởi tạo Visual Editor cho phần tử 'editable-content'.");
                
                // Thêm một lớp để đánh dấu rằng editor đã "khởi tạo"
                editableContent.style.border = '3px solid red';
                editableContent.innerHTML += '<p style="color: red; font-weight: bold;">[VISUAL EDITOR INITIALIZED AFTER > 10 SECONDS DELAY]</p>';
            }
        });
    </script>
</body>
</html>
