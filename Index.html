<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Isolated Visual Editor Slow Load Issue Simulation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            width: 90%;
            margin: 20px auto;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .normal-section {
            background-color: #e9ecef;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #28a745;
        }
        .slow-section {
            background-color: #fff3cd;
            padding: 15px;
            border: 1px solid #ffc107;
        }
        /* CSS đơn giản, không gây chậm trễ cho việc tải trang */
    </style>
</head>
<body>
    <div class="container">
        <h1>Trang Tải Nhanh - Vấn đề Cô Lập</h1>
        
        <div class="normal-section">
            <h2>Phần Nội Dung Tải Nhanh</h2>
            <p>Phần này có cấu trúc DOM đơn giản và sẽ được tải gần như ngay lập tức. Trình duyệt sẽ hiển thị nội dung này rất nhanh chóng.</p>
            <p>Đây là nội dung bình thường, không gây ra bất kỳ vấn đề hiệu suất nào cho quá trình tải trang tổng thể.</p>
        </div>

        <!-- Phần tử này sẽ chứa nội dung phức tạp gây chậm visual editor -->
        <div id="editable-content" class="slow-section">
            <h2>Phần Nội Dung Gây Chậm Visual Editor</h2>
            <p>Phần này được thiết kế để mô phỏng một khối nội dung phức tạp mà visual editor sẽ phải xử lý khi khởi tạo. Sự chậm trễ sẽ xảy ra khi editor cố gắng phân tích và chuyển đổi nội dung bên trong `id="editable-content"`.</p>
            
            <!-- Bắt đầu tạo DOM phức tạp bên trong phần tử này -->
            <div id="complex-dom-structure">
                <!-- Lặp lại cấu trúc lồng nhau và rộng để tăng độ phức tạp DOM -->
                <!-- Giả lập 1000 phần tử lặp lại để tăng kích thước DOM và độ sâu -->
                <div class="row">
                    <div class="col">
                        <p>Dữ liệu phức tạp 1</p>
                        <div class="nested-level-1">
                            <div class="nested-level-2">
                                <div class="nested-level-3">
                                    <!-- Lặp lại 1000 phần tử nhỏ để tăng độ rộng DOM -->
                                    <span class="data-point">Item 1</span>
                                    <span class="data-point">Item 2</span>
                                    <span class="data-point">Item 3</span>
                                    <span class="data-point">Item 4</span>
                                    <span class="data-point">Item 5</span>
                                    <!-- ... (sẽ lặp lại 1000 lần) ... -->
                                    <span class="data-point">Item 1000</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Kết thúc tạo DOM phức tạp -->
        </div>
        
        <div class="normal-section">
            <h2>Phần Nội Dung Tải Nhanh Khác</h2>
            <p>Phần này cũng tải nhanh và chứng minh rằng vấn đề chỉ nằm ở phần tử trên.</p>
        </div>
    </div>

    <script>
        // Hàm chặn luồng chính (main thread)
        function blockExecution(milliseconds) {
            const start = Date.now();
            while (Date.now() < start + milliseconds) {
                // Chặn luồng chính
            }
        }

        // Mô phỏng script khởi tạo của Visual Editor
        // Script này sẽ chạy sau khi DOM đã được tải và nhắm mục tiêu vào phần tử phức tạp.
        document.addEventListener('DOMContentLoaded', function() {
            const editableContent = document.getElementById('editable-content');
            
            if (editableContent) {
                console.log("Trang đã tải xong. Bắt đầu mô phỏng khởi tạo Visual Editor cho phần tử 'editable-content'...");
                
                // Giả định rằng Visual Editor cần 8.5 giây để phân tích và chuyển đổi nội dung phức tạp này
                // Đây là điểm gây ra sự chậm trễ > 8 giây
                blockExecution(8500); 
                
                console.log("Hoàn thành khởi tạo Visual Editor cho phần tử 'editable-content'.");
                
                // Thêm một lớp để đánh dấu rằng editor đã "khởi tạo"
                editableContent.style.border = '3px solid red';
                editableContent.innerHTML += '<p style="color: red; font-weight: bold;">[VISUAL EDITOR INITIALIZED AFTER > 8 SECONDS DELAY]</p>';
            }
        });
    </script>
</body>
</html>
